# μ—”ν‹°ν‹° λ§¤ν•‘  
JPAλ¥Ό μ‚¬μ©ν•¨μ— μμ–΄ κ°€μ¥ μ¤‘μ”ν• μΌμ€ **μ—”ν‹°ν‹°**μ™€ **ν…μ΄λΈ”**μ„ λ§¤ν•‘ν•λ” κ³Όμ •μ΄λ‹¤.     
λ”°λΌμ„ JPAλ¥Ό μ¬λ°”λ¥΄κ² ν™μ©ν•κ³ μ ν•λ‹¤λ©΄, λ§¤ν•‘ μ–΄λ…Έν…μ΄μ…μ„ μ™μ§€ν•κ³  μ‚¬μ©ν•΄μ•Ό ν•λ‹¤.       
   
* κ°μ²΄μ™€ ν…μ΄λΈ” : `@Entity`, `@Table`  
* κΈ°λ³Έ ν‚¤ λ§¤ν•‘ : `@Id`
* ν•„λ“μ™€ μ»¬λΌ λ§¤ν•‘ : `@Column`  
* μ—°κ΄€κ΄€κ³„ λ§¤ν•‘ : `@ManyToOne`, `@JoinColumn`   

# @Entity
`@Entity`λ¶™μ€ ν΄λμ¤λ” JPAκ°€ κ΄€λ¦¬ν•λ” ν΄λμ¤λ΅ μ§€μ •ν•λ” κ²ƒμΌλ΅   
JPAλ¥Ό μ‚¬μ©ν•΄μ„ ν…μ΄λΈ”κ³Ό λ§¤ν•‘ν•  ν΄λμ¤λ” `@Entity` μ–΄λ…Έν…μ΄μ…μ„ ν•„μλ΅ λ¶™μ—¬μ•Όν•λ‹¤.   
κ·Έλ¦¬κ³  μ΄λ¬ν• ν΄λμ¤λ¥Ό μ°λ¦¬λ” `μ—”ν‹°ν‹°`λΌκ³  λ¶€λ¥Έλ‹¤.  

|μ†μ„±|κΈ°λ¥|κΈ°λ³Έκ°’|
|----|----|------|
|name|JPAμ—μ„ μ‚¬μ©ν•  μ—”ν‹°ν‹° μ΄λ¦„μ„ μ§€μ •ν•λ‹¤.<br>λ³΄ν†µ κΈ°λ³Έκ°’μΈ ν΄λμ¤ μ΄λ¦„μ„ μ‚¬μ©ν•μ§€λ§,<br>λ‹¤λ¥Έ λ””λ ‰ν† λ¦¬μ— λ™μΌν• μ΄λ¦„μ ν΄λμ¤κ°€ μλ‹¤λ©΄ μ¶©λμ΄ λ‚λ‹¤.<br>μ΄ κ°™μ€ κ²½μ°λ” ν•΄λ‹Ή μ†μ„± κ°’μ„ ν†µν•΄ μ΄λ¦„μ„ λ³€κ²½ν•΄μ£Όμ|ν΄λμ¤μ μ΄λ¦„μ„ κ·Έλ€λ΅ μ‚¬μ©ν•λ‹¤.|     

**`@Entity` μ£Όμμ‚¬ν•­**   
* κΈ°λ³Έ μƒμ„±μλ” ν•„μλ‹¤.(νλΌλ―Έν„°κ°€ μ—†λ” / public, protected λ΅λ§ κ°€λ¥)  
* `final ν΄λμ¤`, `enum`, `interface`, `inner ν΄λμ¤`μ—λ” μ‚¬μ©ν•  μ μ—†λ‹¤.   
* μ €μ¥ν•  ν•„λ“μ— `final`μ„ μ‚¬μ©ν•λ©΄ μ• λλ‹¤.    
  
μ΄λ¬ν• μ£Όμμ‚¬ν•­ λ•λ¬Έμ— `λ””ν΄νΈ μƒμ„±μ`λ¥Ό κ³ λ ¤ν•΄λ³Ό μλ” μμ§€λ§,      
μ•„μ‹λ‹¤μ‹ν”Ό λ‹¤λ¥Έ μƒμ„±μκ°€ μ΅΄μ¬ν•λ©΄ μλ™μΌλ΅ μ¶”κ°€λμ§€ μ•μΌλ―€λ΅     
`κΈ°λ³Έ μƒμ„±μ`λ” λ…ν™•ν κΈ°μ ν•΄μ£Όλ„λ΅ ν•λ” κ²ƒμ΄ μΆ‹λ‹¤.     
    
**κ¶κΈμ¦, μ •λ§λ΅ finalμ„ μ‚¬μ©ν•  μλ” μ—†λ” κ²ƒμΌκΉ? π¤”**   
* μ‚¬μ‹¤, μ—”ν‹°ν‹° ν΄λμ¤μ—λ„ `final`μ„ μ‚¬μ©ν•  μ μμΌλ©° κΈ°λ³Έμ μΈ λ™μ‘μ—λ” λ¬Έμ κ°€ μ—†λ‹¤. 
* λ‹¨, JPAλ” μ§€μ—°λ΅λ”©(lazy-loading)μ‹μ— proxy κ°μ²΄λ¥Ό λ§λ“λ”λ° μ΄λ• μ‚¬μ©μ΄ λ¶κ°€λ¥ν•΄μ§„λ‹¤.   
    * μ§€μ—°λ΅λ”©μ€ `proxy κ°μ²΄`λ¥Ό λ§λ“¤μ–΄ λ†“μ•λ‹¤κ°€ μ‹¤μ  μ—”ν‹°ν‹°λ¥Ό μ‚¬μ©ν•  λ• μΏΌλ¦¬λ¥Ό λ‚ λ ¤μ„ κ°’μ„ κ°€μ Έμ¨λ‹¤.      
    * κ·Έλ ‡κΈ°μ— μ΄λ¬ν• `proxy κ°μ²΄`μ—μ„ λ¬Έμ κ°€ λ°μƒν•κΈ°μ— μ‚¬μ©ν•μ§€ λ§λΌκ³  κ¶μ¥ν•λ” κ²ƒμ΄λ‹¤.
* μ°Έκ³ λ΅ `final`μ„ μ‚¬μ©ν•  κ²½μ° μ½”ν‹€λ¦°μ—μ„λ” λ¬Έμ κ°€ ν¬κ² λ°μƒν•λ‹¤κ³  ν•λ‹¤.        
* [μ°Έκ³  μ‚¬μ΄νΈ](https://effectivesquid.tistory.com/entry/Kotlin-JPA-%EC%82%AC%EC%9A%A9%EC%8B%9C-Entity-%EC%A0%95%EC%9D%98)

# @Table  
`@Table`μ€ μ—”ν‹°ν‹°μ™€ λ§¤ν•‘ν•  ν…μ΄λΈ”μ„ μ§€μ •ν•λ‹¤.   
    
|μ†μ„±|κΈ°λ¥|κΈ°λ³Έκ°’|
|----|----|------|
|name|λ§¤ν•‘ν•  ν…μ΄λΈ” μ΄λ¦„|μ—”ν‹°ν‹° μ΄λ¦„μ„ μ‚¬μ©ν•λ‹¤.|
|[catalog](https://stackoverflow.com/questions/11184025/what-are-the-jpa-table-annotation-catalog-and-schema-variables-used-for)|catalog  κΈ°λ¥μ΄ μλ” λ°μ΄ν„°λ² μ΄μ¤μ—μ„ catalogλ¥Ό λ§¤ν•‘ν•λ‹¤.||
|schema|schema κΈ°λ¥μ΄ μλ” λ°μ΄ν„°λ² μ΄μ¤μ—μ„ schemaλ¥Ό λ§¤ν•‘ν•λ‹¤.<br>μ°Έκ³ λ΅ μ΄μ „μ—, `μ¤ν‚¤λ§ == λ°μ΄ν„°λ² μ΄μ¤`λΌλ” μ‹μΌλ΅ μΈμ‹μ΄ λμ—λ”λ°<br>ν•΄λ‹Ή λ¶€λ¶„μ— λ€ν•΄μ„ λ…ν™•ν λ‚λ μ•Ό ν•λ―€λ΅ [μ°Έκ³ μ‚¬μ΄νΈ](https://ko.strephonsays.com/schema-and-vs-table-9593)λ¥Ό κΈ°λ΅ν•λ‹¤.||
|uniqueConstraints(DDL)|DDL μƒμ„±μ‹μ— μ λ‹ν¬ μ μ•½μ΅°κ±΄μ„ λ§λ“ λ‹¤.<br>2κ° μ΄μƒμ λ³µν•© μ λ‹ν¬ μ μ•½ μ΅°κ±΄λ„ λ§λ“¤ μ μλ‹¤.<br>μ°Έκ³ λ΅ μ¤ν‚¤λ§ μλ™ μƒμ„± κΈ°λ¥μ„ μ‚¬μ©ν•΄μ„ DDLμ„ λ§λ“¤λ•λ§ μ‚¬μ©λλ‹¤.|   
  
**Entity μ™€ Table λ™μ‹μ— nameμ„ μ„¤μ •ν•λ‹¤λ©΄? π¤”**     
```java
@Entity(name = "someThing") // this name will be used to name the Entity
@Table(name = "someThing")  // this name will be used to name a table in DB
// `@Entity`λ” μ—”ν‹°ν‹°μ μ΄λ¦„ λ° μ‹λ³„μ„ μ„ν•΄ μ‚¬μ©λλ‹¤.  
// `@Table`μ€ ν…μ΄λΈ”μ„ λ§¤ν•‘ν•κΈ° μ„ν•΄  μ΄λ¦„ λ° μ‹λ³„μ„ μ„ν•΄ μ‚¬μ©λλ‹¤.  
```
* `@Entity`λ” [HQL](https://docs.jboss.org/hibernate/orm/3.3/reference/ko-KR/html/queryhql.html)μ—μ„ μ—”ν‹°ν‹°λ¥Ό μ‹λ³„ν•  μ΄λ¦„μ„ μ •ν•λ‹¤.  
* `@Table`μ€ μ‹¤μ  λ§¤ν•‘ν•  `Database`μ— μƒμ„±λ  `table`μ μ΄λ¦„μ„ μ§€μ •ν• λ• μ‚¬μ©λλ‹¤.  
* `@Entity(name ="")`λ§ μ΅΄μ¬ν•λ” κ²½μ°, `@Entity`μ `name` μ†μ„±μ— μν•΄, `Entity`μ™€ `Table` μ΄λ¦„μ΄ λ¨λ‘ κ²°μ •λλ‹¤.    
* [μΈν”„λ° μ§λ¬Έ](https://www.inflearn.com/questions/75556)   
* [μ¤νƒ μ¤λ²„ν”λ΅μ°](https://stackoverflow.com/questions/18732646/name-attribute-in-entity-and-table)   
* [μ°Έκ³ μ‚¬μ΄νΈ](https://walkingtechie.blogspot.com/2019/06/difference-between-entity-and-table.html)   

# @Id 
`@Id`λ” κΈ°λ³Έν‚¤ λ§¤ν•‘μ— μ‚¬μ©λλ” μ–΄λ…Έν…μ΄μ…μ΄λ‹¤.   
κ·Έλ ‡λ‹¤λ©΄, DBκ°€ μ κ³µν•λ” κΈ°λ³Έν‚¤ μ „λµμ„ μ μ©ν•λ ¤λ©΄ μ–΄λ–»κ² ν•΄μ•Όν• κΉ?   
   
`JPA`κ°€ μ κ³µν•λ” `DB` κΈ°λ³Έν‚¤ μƒμ„± μ „λµμ€ λ‹¤μκ³Ό κ°™λ‹¤.    
* **μ§μ ‘ ν• λ‹Ή:** κΈ°λ³Έν‚¤λ¥Ό μ• ν”λ¦¬μΌ€μ΄μ…μ—μ„ μ§μ ‘ ν• λ‹Ή
* **μλ™ μƒμ„±:** λ€λ¦¬ν‚¤ μ‚¬μ© λ°©μ‹
    * `@GenerateValue` μ–΄λ…Έν…μ΄μ…μ„ μ‚¬μ©ν•λ‹¤. 
    * **IDENTITY :** κΈ°λ³Έ ν‚¤ μƒμ„±μ„ DBμ— μ„μ„ν•λ‹¤.
    * **SEQUENCE :** DB μ‹ν€€μ¤λ¥Ό μ‚¬μ©ν•΄μ„ κΈ°λ³Έν‚¤λ¥Ό ν• λ‹Ήν•λ‹¤.
    * **TABLE :** ν‚¤ μƒμ„± ν…μ΄λΈ”μ„ μ΄μ©ν•λ‹¤.     
    * **μλ™ μƒμ„± μ „λµμ΄ λ‹¤μ–‘ν• μ΄μ λ”?** -> DB λ²¤λ”λ§λ‹¤ μ§€μ› λ°©μ‹μ΄ λ‹¤λ¥΄κΈ° λ•λ¬Έμ΄λ‹¤.    
        * SEQUENCE : Oracle   
        * IDENTITY(AUTO_INCREAMENT) : MySQL 
        * TABLE : ν‚¤ μƒμ„±μ© ν…μ΄λΈ” λ§λ“¤μ–΄μ„ μ‚¬μ©ν•λ” μ „λµ  
         
```
μ‚¬μ‹¤, ν‚¤ μƒμ„± μ „λµμ„ μ‚¬μ©ν•λ ¤λ©΄ persistence.xmlμ—  
hibernate.id.new_generator_mappings=true μ†μ„±μ„ λ°λ“μ‹ μ¶”κ°€ν•΄μ•Όν•λ‹¤.   
(κ³Όκ±° λ²„μ „κ³Όμ νΈν™μ„±μ„ μ„ν•΄ falseλ΅ λ‘μ—μΌλ‹ μ΄λ¥Ό trueλ΅ λ°”κΏ”μ£Όμλ” λ§μ΄λ‹¤.)  

μ°Έκ³ λ΅ μ΄ μµμ…μ„ trueλ΅ μ„¤μ •ν•λ©΄    
ν‚¤ μƒμ„± κΈ°λ¥μ„ μµμ ν™”ν•λ” allocationSize μ†μ„±μ„ μ‚¬μ©ν•λ” λ°©μ‹μ΄ λ‹¬λΌμ§„λ‹¤.  
allocationSize λ” λ’¤μ— λ‚μ¨λ‹¤κ³  ν•λ‹ μΌλ‹¨ λƒ…λ‘”λ‹¤.  

<property name="hibernate.id.new_generator_mappings" values="true" />   
```

[κΉ”λ”ν•κ² μ •λ¦¬ν•μ‹ λ¶„ μ‚¬μ΄νΈ](https://yoonbing9.tistory.com/19)λ„ μ²¨λ¶€ν•΄λ³Έλ‹¤.  


## κΈ°λ³Έν‚¤ μ§μ ‘ ν• λ‹Ή μ „λµ 
`@Id` μ–΄λ…Έν…μ΄μ…μ— λ€ν• μ„¤λ… λ¶€λ¶„μ΄λΌκ³  μƒκ°ν•΄λ„ μΆ‹λ‹¤.   

**`@Id`κ°€ μ μ©λ  μ μλ” νƒ€μ…**   
* μλ°” κΈ°λ³Έν•(ν”„λ¦¬λ―Έν‹°λΈ νƒ€μ…)   
* μλ°” Wrapper ν΄λμ¤ ν•  
* String
* java.util.Date
* java.sql.Date
* java.math.BigDecimal
* java.math.BigInteger 

**κΈ°λ³Έν‚¤ μ§μ ‘ ν• λ‹Ή μ „λµ**
* `@Id` ν•„λ“μ— κ°’μ„ μ±„μ›μ„ μ»¤λ°‹μ„ λ³΄λ‚΄λ” λ°©μ‹.   
* λ§μΌ κ°’μ΄ μ—†λ‹¤λ©΄ μ—λ¬λ¥Ό λ°μƒμ‹ν‚¨λ‹¤.(λ‹¨, μ–΄λ–¤ μμ™Έκ°€ λ°μƒν–λ”μ§€λ” μ •μλμ–΄μμ§€ μ•λ‹¤.)

## IDENTITY μ „λµ 
`IDENTITY μ „λµ`μ€ κΈ°λ³Έν‚¤ μƒμ„±μ„ `DBμ— μ„μ„`ν•λ” κ²ƒμ΄λ‹¤.  

```java
μ½”λ“ μ…λ ¥ λ¶€νƒ
```

**μ‚¬μ© λ°©λ²•**
* `@GeneratedValue(strategy = GenerationType.IDENTITY)`μ„ `@id` λ¶™μ€ ν•„λ“μ— κΈ°μ ν•λ‹¤.   
* `@id`κ°€ λ¶™μ€ ν•„λ“μ κ°’μ΄ λΉ„μ–΄ μμ–΄μ•Ό ν•λ‹¤.
  
**νΉμ§•**  
* jpa μ…μ¥μ—μ„λ” μ—”ν‹°ν‹°λ¥Ό μμ† μƒνƒμ— λ§λ“¤κΈ° μ„ν•΄μ„ , κΈ°λ³Έν‚¤λ¥Ό λ¨Όμ € μ•μ•„μ•Όν•λ‹¤.    
* λ”°λΌμ„ `em.persist()` μ‹μ μ— μ“°κΈ° μ§€μ—°μ„ ν•μ§€μ•κ³       
  λ°”λ΅ μΏΌλ¦¬λ¥Ό DBμ— λ‚ λ ¤ λ°μ΄ν„°λ¥Ό λ“±λ΅ν•κ³  μ‹λ³„μλ¥Ό λ¦¬ν„΄λ°›λ”λ‹¤.         
          
## SEQUENCE      
λ°μ΄ν„°λ² μ΄μ¤ μ‹ν€€μ¤λ”       
μ μΌν• κ°’μ„ μμ„λ€λ΅ `μƒμ„±`ν•λ” λ°μ΄ν„°λ² μ΄μ¤ μ¤λΈμ νΈλ‹¤.      
`SEQUENCE` μ „λµμ€ μ΄ μ‹ν€€μ¤λ¥Ό μ‚¬μ©ν•΄μ„ κΈ°λ³Έν‚¤λ¥Ό μƒμ„±ν•λ” μ „λµμ΄λ‹¤.       
  
