# ì—°ê´€ ê´€ê³„ ë§¤í•‘ ê¸°ì´ˆ  
ì—”í‹°í‹°ë“¤ì€ ëŒ€ë¶€ë¶„ ë‹¤ë¥¸ ì—”í‹°í‹°ì™€ ì—°ê´€ê´€ê³„ê°€ ìˆë‹¤.    
ê·¸ëŸ°ë° **ê°ì²´ëŠ” ì°¸ì¡°**ë¥¼ ì‚¬ìš©í•´ì„œ ê´€ê³„ë¥¼ ë§ºê³  **í…Œì´ë¸”ì€ ì™¸ë˜í‚¤**ë¥¼ ì‚¬ìš©í•´ì„œ ê´€ê³„ë¥¼ ë§ºëŠ”ë‹¤.     
`ORM`ì—ì„œ ê°€ì¥ ì–´ë ¤ìš´ ë¶€ë¶„ì´ **`ê°ì²´ ì—°ê´€ê´€ê³„`ì™€ `í…Œì´ë¸” ì—°ê´€ê´€ê³„`ë¥¼ ë§¤í•‘í•˜ëŠ” ê²ƒì´ë‹¤.**         

* **ë°©í–¥(Direction) :**   
    * ë‹¨ë°˜í–¥/ì–‘ë°©í–¥ì´ ìˆë‹¤.
    * **ë‹¨ë°©í–¥ :** ë‘˜ ì¤‘ í•˜ë‚˜ë§Œ ì°¸ì¡° 
    * **ì–‘ë°©í–¥ :** ì–‘ìª½ ëª¨ë‘ ì„œë¡œë¥¼ ì°¸ì¡°  
    * ë°©í–¥ì€ ê°ì²´ ê´€ê³„ì—ì„œë§Œ ì¡´ì¬í•˜ê³  **í…Œì´ë¸” ê´€ê³„ëŠ” í•­ìƒ ì–‘ë°©í–¥**ì´ë‹¤.  
* **ë‹¤ì¤‘ì„±(Multiplicity) :**  
    * `N:1`, `1:N`, `1:1`, `N:M` ë‹¤ì¤‘ì„±ì´ ìˆë‹¤.   
* **ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ :**  
    * ê°ì²´ë¥¼ ì–‘ë°©í–¥ ê´€ê³„ë¡œ ë§Œë“¤ë©´ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì„ ì •í•´ì•¼ í•œë‹¤.   

# ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„ (1:N)   
  
**ê°€ì •**
* íšŒì›ê³¼ íŒ€ì´ ìˆë‹¤.  
* íšŒì›ì€ í•˜ë‚˜ì˜ íŒ€ì—ë§Œ ì†Œì†ë  ìˆ˜ ìˆë‹¤.  
* íšŒì›ê³¼ íŒ€ì€ `ë‹¤ëŒ€ì¼(1:N)` ê´€ê³„ì´ë‹¤.  
  
[PPT]()

**ê°ì²´ ì—°ê´€ê´€ê³„**  
* `Member ê°ì²´`ëŠ” `Member.team`í•„ë“œë¡œ `Team ê°ì²´`ì™€ ì—°ê´€ê´€ê³„ë¥¼ ë§ºëŠ”ë‹¤.  
* **ë‹¨ë°©í–¥ ê´€ê³„ì´ë‹¤.**   
    * íšŒì›ì€ -> íŒ€ì„ ì•Œ ìˆ˜ ìˆë‹¤. 
    * íŒ€ -> íšŒì›ì„ ì•Œ ìˆ˜ ì—†ë‹¤.  
  
**í…Œì´ë¸” ì—°ê´€ê´€ê³„**   
* `Member í…Œì´ë¸”`ì€ `TEAM_ID` ì™¸ë˜ í‚¤ë¡œ `Team í…Œì´ë¸”`ê³¼ ì—°ê´€ê´€ê³„ë¥¼ ë§ºëŠ”ë‹¤.  
* `Member í…Œì´ë¸”`ê³¼ `Team í…Œì´ë¸”`ì€ **ì–‘ë°©í–¥ ê´€ê³„ì´ë‹¤.**  
    * `Member í…Œì´ë¸”`ì€ `TEAM_ID`ë¥¼ í†µí•´ `Team`ì„ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤. (íšŒì›ê³¼ íŒ€)  
    * `Team í…Œì´ë¸”`ì€ `PK`ì¸, `TEAM_ID`ë¥¼ í†µí•´ `Member`ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.(íŒ€ê³¼ íšŒì›)  
    * ì¦‰, `MEMBER JOIN TEAM(íšŒì›ê³¼ íŒ€)`ì€ ë¬¼ë¡ , `TEAM JOIN MEMBER(íŒ€ê³¼ íšŒì›)`ë„ ê°€ëŠ¥í•˜ë‹¤.     
      
**ê°ì²´ ì—°ê´€ê´€ê³„ì™€ í…Œì´ë¸” ì—°ê´€ê´€ê³„ì˜ ê°€ì¥ í° ì°¨ì´**   
**ì°¸ì¡°ë¥¼ í†µí•œ ì—°ê´€ê´€ê³„ëŠ” ì–¸ì œë‚˜ ë‹¨ë°©í–¥ì´ë‹¤.**  
ê°ì²´ê°„ì˜ ì—°ê´€ê´€ê³„ë¥¼ **ì–‘ë°©í–¥ìœ¼ë¡œ ë§Œë“¤ê³  ì‹¶ìœ¼ë©´**     
**ë°˜ëŒ€ìª½ì—ë„ í•„ë“œë¥¼ ì¶”ê°€í•´ì„œ ì°¸ì¡°ë¥¼ ë³´ê´€í•´ì•¼í•œë‹¤.**   
ì¦‰, ì—°ê´€ê´€ê³„ë¥¼ í•˜ë‚˜ ë” ë§Œë“¤ì–´ì•¼ í•˜ê³  ì´ë¥¼ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ë¼ ë§í•œë‹¤.  
í•˜ì§€ë§Œ, ë³´ë‹¤ ë” ì •í™•íˆ ë§í•˜ë©´,   
**ì–‘ë±¡í–¥ ê´€ê³„ê°€ ì•„ë‹ˆë¼ ì„œë¡œ ë‹¤ë¥¸ ë‹¨ë°©í–¥ ê´€ê³„ 2ê°œì´ë‹¤.**     
    
## ìˆœìˆ˜í•œ ê°ì²´ ì—°ê´€ê´€ê³„   

[PPT]()

**íšŒì›ê³¼ íŒ€ í´ë˜ìŠ¤**
```java
```
**ë™ì‘ ì½”ë“œ**
```java
```

ê°ì²´ëŠ” ì°¸ì¡°ë¥¼ ì‚¬ìš©í•´ì„œ ì—°ê´€ê´€ê³„ë¥¼ íƒìƒ‰í•  ìˆ˜ ìˆëŠ”ë°    
ì´ê²ƒì„ **ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰**ì´ë¼ê³  í•œë‹¤.   
ì°¸ê³ ë¡œ ì´ëŸ¬í•œ ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰ì„ ì§„í–‰í•  ë•Œ, ì§€ì—°ë¡œë”©ì´ íš¨ê³¼ì ìœ¼ë¡œ ì‚¬ìš©ëœë‹¤.    
    
**í…Œì´ë¸” ì—°ê´€ê´€ê³„** 
í…Œì´ë¸” ì—°ê´€ê´€ê³„ëŠ” `FK`ì™€ `JOIN`ì„ ì´ìš©í•˜ì—¬ ì—°ê´€ê´€ê³„ë¥¼ íƒìƒ‰í•œë‹¤.      

## ê°ì²´ ê´€ê³„ ë§¤í•‘ 

[PPT]() 

```java

```
```java
```

* **ê°ì²´ ì—°ê´€ê´€ê³„ :** íšŒì› ê°ì²´ì˜ `Member.team`í•„ë“œ ì‚¬ìš© 
* **í…Œì´ë¸” ì—°ê´€ê´€ê³„ :** íšŒì› í…Œì´ë¸”ì˜ `MEMBER.TEAM_ID` ì™¸ë˜ í‚¤ ì»¬ëŸ¼ì„ ì‚¬ìš©  

`Member.team`ê³¼ `MEMBER.TEAM_ID`ë¥¼ ë§¤í•‘í•˜ëŠ” ê²ƒì´ ì—°ê´€ê´€ê³„ ë§¤í•‘ì´ë‹¤.   
ì´ë¥¼ ë³´ë‹¤ ëª…í™•íˆ ì•Œê¸° ìœ„í•´ ì½”ë“œë¥¼ í™•ì¸í•´ë³´ì   
  
```java
@ManyToOne  
@JoinColumn(name="TEAM_ID")     
private team team;  
```    
* **@ManyToOne :**     
    `ë‹¤ëŒ€ì¼(N:1)`ê´€ê³„ì— ëŒ€í•œ ë§¤í•‘ ì •ë³´,    
    ì—°ê´€ê´€ê³„ë¥¼ ë§¤í•‘í•  ë•Œ ë‹¤ì¤‘ì„±ì„ ë‚˜íƒ€ë‚´ëŠ” ì–´ë…¸í…Œì´ì…˜ì€ í•„ìˆ˜ë¡œ ì‚¬ìš©í•´ì•¼í•œë‹¤.     
* **@JoinColumn(name="TEAM_ID") :**   
    ì™¸ë˜ í‚¤ë¥¼ ë§¤í•‘í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ì–´ë…¸í…Œì´ì…˜ì´ë‹¤.   
    `name` ì†ì„±ì—ëŠ” ë§¤í•‘í•  ì™¸ë˜ í‚¤ ì´ë¦„ì„ ì§€ì •í•œë‹¤.(FK ì´ë¦„ ì •í•˜ëŠ” ê²ƒì´ë‹¤.)      
    í•´ë‹¹ ì–´ë…¸í…Œì´ì…˜ì€ ìƒëµ ê°€ëŠ¥í•˜ê³  ì´ëŸ´ ê²½ìš° ê¸°ë³¸ê°’ì´ ì„¤ì •ëœë‹¤.  

### @ManyToOne
`@ManyToOne` ì–´ë…¸í…Œì´ì…˜ì€ `ë‹¤ëŒ€ì¼(N:1)` ê´€ê³„ì—ì„œ ì‚¬ìš©í•œë‹¤.   

|ì†ì„±|ê¸°ëŠ¥|ê¸°ë³¸ê°’|  
|----|---|------|
|optional|`false`ë¡œ ì„¤ì •í•˜ë©´ ì—°ê´€ëœ ì—”í‹°í‹°ê°€ í•­ìƒ ìˆì–´ì•¼ í•œë‹¤.|true|
|fetch|ê¸€ë¡œë²Œ í˜ì¹˜ ì „ëµì„ ì„¤ì •í•œë‹¤.(ë¡œë”©ì‹œì )|`@ManyToOne=FetchType.EAGER`<br>`@OneToMany=FetchType.LAZY`|   
|cascade|ì˜ì†ì„± ì „ì´ ê¸°ëŠ¥ì„ ì‚¬ìš©í•œë‹¤.||
|targetEntity|ì—°ê´€ëœ ì—”í‹°í‹°ì˜ íƒ€ì… ì •ë³´ë¥¼ ì„¤ì •í•œë‹¤.<br>ì´ ê¸°ëŠ¥ì€ ê±°ì˜ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.<br>ì»¬ë ‰ì…˜ì„ ì‚¬ìš©í•´ë„ ì œë„¤ë¦­ìœ¼ë¡œ íƒ€ì… ì •ë³´ë¥¼ ì•Œ ìˆ˜ ìˆë‹¤.|   
 
ì´ ì¤‘ì—ì„œ `targetEntity`ê³¼ ì œë„¤ë¦­ì˜ ì—°ê´€ì„±ì— ëŒ€í•´ ê°„ëµíˆ í‘œí˜„í•´ë³´ê² ë‹¤.       
```java
@OneToMany
private List<Member> members; // ì œë„¤ë¦­ìœ¼ë¡œ íƒ€ì… ì •ë³´ë¥¼ ì•Œ ìˆ˜ ìˆë‹¤.  

@OneToMany(targetEntity=Member.class)
private List members; // ì œë„¤ë¦­ì´ ì—†ìœ¼ë©´ íƒ€ì… ì •ë³´ë¥¼ ì•Œ ìˆ˜ ì—†ë‹¤.   
```  
`targetEntity`ëŠ” ì œë„¤ë¦­`<>`ì´ ì—†ì„ ê²½ìš°, íƒ€ì… ì •ë³´ë¥¼ ì•Œ ìˆ˜ ì—†ë‹¤.      
**ê·¸ë ‡ë‹¤ë©´ ì œë„¤ë¦­ ë“±ì¥ ì´ì „ì˜ ì½”ë“œë“¤ì€ ì–´ë–»ê²Œ ë™ì‘ì„ í• ê¹Œ?ğŸ¤”**    
ì •í™•íˆ ë§í•˜ë©´, ì œë„¤ë¦­ ë“±ì¥ ì´ì „ì—ëŠ” ëª…í™•íˆ í•´ë‹¹ í´ë˜ìŠ¤ë¥¼ ëª…ì‹œí•´ì¤˜ì•¼ í–ˆë‹¤.       
ê·¸ëŸ¬ë‚˜ ì œë„¤ë¦­ì´ ë“±ì¥í•˜ë©´ì„œ ì´ë¥¼ ìƒëµ ê°€ëŠ¥í•´ì¡Œê¸°ì— ì˜ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²ƒì´ë‹¤.      
    
```java
@ManyToMany(targetEntity=com.example.NoteBook.class)
@JoinTable(name="person_has_notebooks", joinColumns={@JoinColumn(name="person_id")}, inverseJoinColumns={@JoinColumn(name="notebook_id")})
private List notebooks;

@ManyToMany(mappedBy="notebooks", targetEntity=com.example.Person.class)
private List person;
```

[ìŠ¤íƒ ì˜¤ë²„ í”Œë¡œìš°](https://stackoverflow.com/questions/41810463/when-not-using-generics-ensure-the-target-entity-is-defined-on-the-relationship)      
[ì˜¤ë¼í´ ê³µì‹ ë ˆí¼ëŸ°ìŠ¤](https://docs.oracle.com/javaee/6/api/javax/persistence/ManyToMany.html)

**ì°¸ê³ **   
`ë‹¤ëŒ€ì¼(@ManyToOne)`ê³¼ ë¹„ìŠ·í•œ `ì¼ëŒ€ì¼(OneToOne)`ê´€ê³„ë„ ìˆë‹¤.   
ë‹¨ë°©í–¥ ê´€ê³„ë¥¼ ë§¤í•‘í•  ë•Œ ë‘˜ ì¤‘ ì–´ë–¤ ê²ƒì„ ì‚¬ìš©í•´ì•¼ í• ì§€ëŠ” ë°˜ëŒ€í¸ ê´€ê³„ì— ë‹¬ë ¤ìˆë‹¤.   
ë°˜ëŒ€í¸ì´ `ì¼ëŒ€ë‹¤`ê´€ê³„ë©´ `ë‹¤ëŒ€ì¼` ê´€ê³„ê°€ ë˜ëŠ” ê²ƒì´ê³ ,   
ë°˜ëŒ€í¸ì´ `ì¼ëŒ€ì¼` ê´€ê³„ë©´ ë‚˜ë„` ì¼ëŒ€ì¼` ê´€ê³„ê°€ ë˜ëŠ” ê²ƒì´ë‹¤.    
   
### @JoinColumn  
`@JoinColumn`ì€ ì™¸ë˜ í‚¤ë¥¼ ë§¤í•‘í•  ë•Œ ì‚¬ìš©í•œë‹¤.   

|ì†ì„±|ê¸°ëŠ¥|ê¸°ë³¸ê°’|
|---|----|-------|
|name|ë§¤í•‘í•  ì™¸ë˜ í‚¤ ì´ë¦„ (FK ì´ë¦„ì„ ì§€ì •í•˜ëŠ” ê²ƒì´ë‹¤.)|**`í•„ë“œëª…`**+ **`_`** + **`ì°¸ì¡°í•˜ëŠ” í…Œì´ë¸”ì˜ ê¸°ë³¸í‚¤ ì»¬ëŸ¼ëª…`**<br>ì˜ˆì‹œì—ì„œëŠ” **`ë§¤í•‘ë  í´ë˜ìŠ¤_IDí•„ë“œ`** ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒ ê°™ë‹¤.<br>ì˜ˆë¥¼ ë“¤ë©´ `TEAM_ID`ì™€ ê°™ì´ ë§ì´ë‹¤.|  
|referencedColumnName|ì™¸ë˜ í‚¤ê°€ ì°¸ì¡°í•˜ëŠ” ëŒ€ìƒ í…Œì´ë¸”ì˜ ì»¬ëŸ¼ëª…|ì°¸ì¡°í•˜ëŠ” í…Œì´ë¸”ì˜ ê¸°ë³¸í‚¤ ì»¬ëŸ¼ëª…|
|foreignKey(DDL)|ì™¸ë˜ í‚¤ ì œì•½ì¡°ê±´ì„ ì§ì ‘ ì§€ì •í•  ìˆ˜ ìˆë‹¤.<br>ì´ ì†ì„±ì€ í…Œì´ë¸”ì„ ìƒì„±í•  ë•Œë§Œ í•„ìš”í•˜ë‹¤|   
|unique<br>nullable<br>insertable<br>updatable<br>columnDefinition<br>table|`@Column`ì˜ ì†ì„±ë“¤ì´ë‹¤.|

ì•ì„œ ë§í–ˆë“¯ì´ `@JoinColumn`ì€ ìƒëµì´ ê°€ëŠ¥í•˜ë‹¤.   
ì •í™•íˆ ë§í•˜ë©´ `@JoinColumn`ì„ ìƒëµí•´ë„ ì™¸ë˜ í‚¤ë¥¼ ì°¾ëŠ” ê¸°ë³¸ ì „ëµì´ ìˆë‹¤.   

* ê¸°ë³¸ ì „ëµ: **`í•„ë“œëª…`** + **`_`** + **`ì°¸ì¡°í•˜ëŠ” í…Œì´ë¸”ì˜ ì¹¼ëŸ¼ëª…`**   
* ì˜ˆì‹œë¡œ ë“¤ë©´, `team_TEAM_ID`  

# ì—°ê´€ê´€ê³„ ì‚¬ìš©   
ì—°ê´€ê´€ê³„ë¥¼ `ë“±ë¡`, `ìˆ˜ì •`, `ì‚­ì œ`, `ì¡°íšŒ`í•˜ëŠ” ì˜ˆì‹œë¥¼ ë³´ì  

## ì €ì¥ 
```java
package hellojpa;

import hellojpa.domain.Member;
import hellojpa.domain.Team;

import javax.persistence.EntityManager;
import javax.persistence.EntityManagerFactory;
import javax.persistence.EntityTransaction;
import javax.persistence.Persistence;

public class JpaMain {
    public static void main(String[] args) {
        EntityManagerFactory emf = Persistence.createEntityManagerFactory("hello");
        EntityManager em = emf.createEntityManager();
        EntityTransaction tx = em.getTransaction();
        tx.begin();
        try {
            Team team = new Team();
            team.setName("myTeam");
            em.persist(team);

            Member member = new Member();
            member.setName("kwj1270");
            member.setTeam(team);
            em.persist(member);

            Member findMember = em.find(Member.class, member.getId());
            Team findTeam = findMember.getTeam();
            System.out.println(findTeam.getName());
            
            tx.commit();
        } catch (Exception e) {
            tx.rollback();
        } finally {
            em.close();
        }
        emf.close();
    }
}
```
`em.persist(ê°ì²´);`ë¥¼ ì´ìš©í•˜ì—¬ ì €ì¥ì„ ì‹œí‚¨ í›„(ì˜ì†ì„±ìœ¼ë¡œ ë§Œë“ ë‹¤)     
`member.setTeam(team);`ì— ì €ì¥ì„ ì‹œì¼°ë‹¤.     
ë§Œì•½, í•œ ê°œì˜ ì—”í‹°í‹°ë¼ë„ `em.persist(ê°ì²´);`ë¥¼ ë¹¼ë¨¹ì„ ê²½ìš°ì—ëŠ” ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.        
ë‹¨, ì•„ë˜ì™€ ê°™ì€ ê²½ìš°ëŠ” ìƒê´€ì´ ì—†ë‹¤.  

```java
            Team team = new Team();
            team.setName("myTeam");

            Member member = new Member();
            member.setName("kwj1270");
            member.setTeam(team);
            em.persist(member);
            em.persist(team);
```

`member`ë¥¼ ë¨¼ì € `persist()`í•˜ê³  `team`ì„ `persist()`í•´ë„ ìƒê´€ì´ ì—†ì—ˆë‹¤.       
     
     
    
# ì°¸ê³  
https://www.inflearn.com/questions/113969

